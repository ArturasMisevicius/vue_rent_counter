# ДЕТАЛЬНЫЕ ПОЛЬЗОВАТЕЛЬСКИЕ СЦЕНАРИИ
## End-to-End User Journeys для проектирования интерфейса

**Дата создания:** 8 декабря 2025  
**Версия:** 1.0  
**Язык:** Русский  
**Назначение:** Техническое задание для UX/UI дизайнера

---

## 📋 СОДЕРЖАНИЕ

1. [Сценарий 1: Onboarding клиента (B2B)](#сценарий-1-onboarding-клиента-b2b)
2. [Сценарий 2: Настройка объекта (Setup)](#сценарий-2-настройка-объекта-setup)
3. [Сценарий 3: Путь жильца (B2C Onboarding)](#сценарий-3-путь-жильца-b2c-onboarding)
4. [Сценарий 4: Ежемесячная рутина (The Loop)](#сценарий-4-ежемесячная-рутина-the-loop)
5. [Сценарий 5: Биллинг и закрытие месяца](#сценарий-5-биллинг-и-закрытие-месяца)

---

## СЦЕНАРИЙ 1: ONBOARDING КЛИЕНТА (B2B)

### 🎬 АКТОРЫ
- **Главный герой:** Супер-Админ (владелец системы)
- **Второстепенный герой:** Новый Админ (владелец недвижимости)

### 📖 СЮЖЕТ

#### ШАГ 1.1: Получение заявки

**Действие:**
- Супер-Админ получает email от потенциального клиента:
  ```
  От: ivan.petrov@upravdom.lt
  Тема: Заявка на подключение к системе
  
  Здравствуйте! Мы управляющая компания "УправДом".
  У нас 3 здания, 45 квартир. Хотим подключиться к вашей системе.
  ```

**Система:**
- Email приходит на `support@rent-counter.com`
- Супер-Админ видит уведомление в своей почте

**Интерфейс:**
- Супер-Админ открывает браузер
- Переходит на `https://rent-counter.com/login`

---

#### ШАГ 1.2: Вход Супер-Админа

**Действие:**
- Супер-Админ вводит:
  - Email: `superadmin@example.com`
  - Пароль: `••••••••`
- Нажимает кнопку "Войти"

**Система:**
- Проверяет учетные данные в базе
- Проверяет роль: `role = 'superadmin'`
- Создает сессию
- Генерирует CSRF токен

**Интерфейс:**
- Перенаправление на `/superadmin/dashboard`
- Загружается дашборд Супер-Админа

**Что видит Супер-Админ:**
```
┌─────────────────────────────────────────────────────┐
│ 🏢 SUPERADMIN DASHBOARD                             │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 📊 СИСТЕМНАЯ СТАТИСТИКА                            │
│ ┌──────────┬──────────┬──────────┬──────────┐      │
│ │ Организ. │ Объекты  │ Здания   │ Счета    │      │
│ │    15    │   450    │    45    │  1,250   │      │
│ └──────────┴──────────┴──────────┴──────────┘      │
│                                                     │
│ ⚠️ ПОДПИСКИ, ТРЕБУЮЩИЕ ВНИМАНИЯ                    │
│ • Истекают в течение 14 дней: 3                    │
│ • Истекли (grace period): 1                        │
│                                                     │
│ [+ Создать организацию]                            │
│                                                     │
│ 📋 СПИСОК ОРГАНИЗАЦИЙ                              │
│ ┌────────────────────────────────────────────┐     │
│ │ Название         │ План    │ Истекает     │     │
│ ├────────────────────────────────────────────┤     │
│ │ ООО "УправДом"   │ Pro     │ 15.01.2025   │     │
│ │ ИП Иванов        │ Basic   │ 20.03.2025   │     │
│ └────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────┘
```

---

#### ШАГ 1.3: Создание новой организации

**Действие:**
- Супер-Админ нажимает кнопку **"+ Создать организацию"**

**Система:**
- Переход на `/superadmin/organizations/create`
- Загружается форма создания

**Интерфейс:**
- Открывается страница с формой:

```
┌─────────────────────────────────────────────────────┐
│ ← Назад к списку                                    │
│                                                     │
│ СОЗДАНИЕ НОВОЙ ОРГАНИЗАЦИИ                          │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 👤 ИНФОРМАЦИЯ ОБ АДМИНИСТРАТОРЕ             │   │
│ ├─────────────────────────────────────────────┤   │
│ │                                             │   │
│ │ Имя администратора *                        │   │
│ │ [Иван Петров                              ] │   │
│ │                                             │   │
│ │ Email *                                     │   │
│ │ [ivan.petrov@upravdom.lt                  ] │   │
│ │ ℹ️ На этот email будут отправлены данные    │   │
│ │    для входа                                │   │
│ │                                             │   │
│ │ Временный пароль *                          │   │
│ │ [••••••••                                 ] │   │
│ │ [👁️ Показать]                               │   │
│ │                                             │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 🏢 ИНФОРМАЦИЯ ОБ ОРГАНИЗАЦИИ                │   │
│ ├─────────────────────────────────────────────┤   │
│ │                                             │   │
│ │ Название организации *                      │   │
│ │ [ООО "УправДом"                           ] │   │
│ │                                             │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 💳 ПОДПИСКА                                 │   │
│ ├─────────────────────────────────────────────┤   │
│ │                                             │   │
│ │ План подписки *                             │   │
│ │ ┌─────────┬─────────┬─────────┐            │   │
│ │ │ Basic   │ Pro     │Enterprise│            │   │
│ │ │ 10 объ. │ 50 объ. │Unlimited │            │   │
│ │ │ 50 жил. │200 жил. │Unlimited │            │   │
│ │ │ [    ]  │ [✓]     │ [    ]   │            │   │
│ │ └─────────┴─────────┴─────────┘            │   │
│ │                                             │   │
│ │ Дата истечения *                            │   │
│ │ [📅 15.12.2025                            ] │   │
│ │ ℹ️ По умолчанию: +1 год от сегодня          │   │
│ │                                             │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ [Отмена]                    [Создать организацию]  │
└─────────────────────────────────────────────────────┘
```

**Действие:**
- Супер-Админ заполняет форму:
  - Имя: `Иван Петров`
  - Email: `ivan.petrov@upravdom.lt`
  - Пароль: `TempPass2024!`
  - Организация: `ООО "УправДом"`
  - План: выбирает `Professional` (радиокнопка)
  - Дата истечения: оставляет по умолчанию (через год)
- Нажимает кнопку **"Создать организацию"**

**Система:**
1. **Валидация на клиенте (JavaScript):**
   - Проверка заполнения обязательных полей
   - Проверка формата email
   - Проверка длины пароля (минимум 8 символов)

2. **Отправка на сервер (POST `/superadmin/organizations`):**
   ```json
   {
     "name": "Иван Петров",
     "email": "ivan.petrov@upravdom.lt",
     "password": "TempPass2024!",
     "organization_name": "ООО \"УправДом\"",
     "plan_type": "professional",
     "expires_at": "2025-12-15"
   }
   ```

3. **Обработка на сервере:**
   - Проверка уникальности email в базе
   - Генерация уникального `tenant_id` (например: `458923`)
   - Хеширование пароля (bcrypt)
   - Создание записи в таблице `users`:
     ```sql
     INSERT INTO users (
       name, email, password, role, tenant_id, 
       organization_name, is_active
     ) VALUES (
       'Иван Петров',
       'ivan.petrov@upravdom.lt',
       '$2y$10$...',  -- хешированный пароль
       'admin',
       458923,
       'ООО "УправДом"',
       true
     )
     ```
   - Создание записи в таблице `subscriptions`:
     ```sql
     INSERT INTO subscriptions (
       user_id, plan_type, status, starts_at, 
       expires_at, max_properties, max_tenants
     ) VALUES (
       [ID нового админа],
       'professional',
       'active',
       '2024-12-08',
       '2025-12-15',
       50,   -- лимит для Professional
       200   -- лимит для Professional
     )
     ```
   - Отправка приветственного email:
     ```
     Кому: ivan.petrov@upravdom.lt
     Тема: Добро пожаловать в Rent Counter!
     
     Здравствуйте, Иван Петров!
     
     Ваша организация "ООО УправДом" успешно зарегистрирована.
     
     Данные для входа:
     Email: ivan.petrov@upravdom.lt
     Пароль: TempPass2024!
     
     Ссылка для входа: https://rent-counter.com/login
     
     Рекомендуем сменить пароль после первого входа.
     ```

**Интерфейс:**
- Показывается уведомление: ✅ "Организация успешно создана"
- Перенаправление на `/superadmin/organizations/[ID]`
- Открывается страница просмотра новой организации:

```
┌─────────────────────────────────────────────────────┐
│ ← Назад к списку                                    │
│                                                     │
│ 🏢 ООО "УПРАВДОМ"                                   │
│ 📧 ivan.petrov@upravdom.lt                          │
│ 🟢 Активна                                          │
│                                                     │
│ [Редактировать] [Приостановить] [Удалить]          │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 💳 ПОДПИСКА                                 │   │
│ ├─────────────────────────────────────────────┤   │
│ │ План: Professional                          │   │
│ │ Статус: ✅ Активна                          │   │
│ │ Начало: 08.12.2024                          │   │
│ │ Истекает: 15.12.2025 (372 дня)              │   │
│ │                                             │   │
│ │ Лимиты:                                     │   │
│ │ • Объекты: 0 / 50                           │   │
│ │ • Жильцы: 0 / 200                           │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 📊 СТАТИСТИКА                               │   │
│ ├─────────────────────────────────────────────┤   │
│ │ Объектов: 0                                 │   │
│ │ Зданий: 0                                   │   │
│ │ Жильцов: 0                                  │   │
│ │ Счетов: 0                                   │   │
│ └─────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

---

#### ШАГ 1.4: Первый вход нового Админа

**Действие:**
- Иван Петров получает email
- Открывает ссылку `https://rent-counter.com/login`
- Вводит:
  - Email: `ivan.petrov@upravdom.lt`
  - Пароль: `TempPass2024!`
- Нажимает "Войти"

**Система:**
1. Проверка учетных данных
2. Проверка роли: `role = 'admin'`
3. Проверка статуса: `is_active = true`
4. Проверка подписки:
   - Загрузка записи из `subscriptions`
   - Проверка `status = 'active'`
   - Проверка `expires_at > now()`
5. Создание сессии
6. Установка локали (по умолчанию: английский)

**Интерфейс:**
- Перенаправление на `/admin` (панель Filament)
- Загружается дашборд Админа (ПЕРВЫЙ ВХОД - пустой):

```
┌─────────────────────────────────────────────────────┐
│ 🏢 Rent Counter | ООО "УправДом"                    │
│ 👤 Иван Петров | 🌐 EN ▼ | 🔔 | 👤 ▼                │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 🎉 ДОБРО ПОЖАЛОВАТЬ В RENT COUNTER!                │
│                                                     │
│ Ваша организация успешно создана.                   │
│ Начните с настройки вашего первого здания.         │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 🚀 БЫСТРЫЙ СТАРТ                            │   │
│ ├─────────────────────────────────────────────┤   │
│ │                                             │   │
│ │ 1️⃣ [+ Создать здание]                       │   │
│ │    Добавьте информацию о вашем доме         │   │
│ │                                             │   │
│ │ 2️⃣ [+ Добавить квартиры]                    │   │
│ │    Создайте объекты недвижимости            │   │
│ │                                             │   │
│ │ 3️⃣ [+ Установить счетчики]                  │   │
│ │    Зарегистрируйте приборы учета            │   │
│ │                                             │   │
│ │ 4️⃣ [+ Пригласить жильцов]                   │   │
│ │    Создайте учетные записи жильцов          │   │
│ │                                             │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 💳 ВАША ПОДПИСКА                            │   │
│ ├─────────────────────────────────────────────┤   │
│ │ План: Professional                          │   │
│ │ Истекает: 15.12.2025 (372 дня)              │   │
│ │ Использовано: 0/50 объектов, 0/200 жильцов │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ 📚 [Посмотреть руководство] [Видео-инструкция]    │
└─────────────────────────────────────────────────────┘

БОКОВОЕ МЕНЮ:
├─ 📊 Dashboard
├─ 🏢 Operations ▼
│  ├─ 🏠 Properties (0)
│  ├─ 🏢 Buildings (0)
│  ├─ ⚡ Meters (0)
│  └─ 📊 Meter Readings (0)
├─ 💰 Billing ▼
│  ├─ 🧾 Invoices (0)
│  ├─ 💵 Tariffs (0)
│  └─ 🏭 Providers (0)
├─ 👥 Users (0)
└─ ⚙️ Settings
```

**Важно:** Это специальный экран "первого входа" (onboarding wizard), который показывается только один раз.

---

## СЦЕНАРИЙ 2: НАСТРОЙКА ОБЪЕКТА (Setup)

### 🎬 АКТОР
- **Главный герой:** Админ (Иван Петров)

### 📖 СЮЖЕТ

#### ШАГ 2.1: Создание здания

**Действие:**
- Админ нажимает кнопку **"1️⃣ Создать здание"** на дашборде
- ИЛИ выбирает в меню: **Operations → Buildings → Create**

**Система:**
- Переход на `/admin/buildings/create`
- Загружается форма Filament

**Интерфейс:**
```
┌─────────────────────────────────────────────────────┐
│ ← Buildings                                         │
│                                                     │
│ CREATE BUILDING                                     │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ Name *                                      │   │
│ │ [Жилой комплекс "Солнечный"               ] │   │
│ │                                             │   │
│ │ Address *                                   │   │
│ │ [ул. Гедиминаса, д. 15, Вильнюс           ] │   │
│ │                                             │   │
│ │ Total Apartments *                          │   │
│ │ [45                                       ] │   │
│ │ ℹ️ Используется для расчета hot water circulation       │   │
│ │                                             │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ [Cancel]                                  [Create]  │
└─────────────────────────────────────────────────────┘
```

**Действие:**
- Админ заполняет:
  - Name: `Жилой комплекс "Солнечный"`
  - Address: `ул. Гедиминаса, д. 15, Вильнюс`
  - Total Apartments: `45`
- Нажимает **"Create"**

**Система:**
1. **Валидация:**
   - Name: обязательно, макс 255 символов
   - Address: обязательно, макс 255 символов
   - Total Apartments: обязательно, число от 1 до 1000

2. **Сохранение (POST `/admin/buildings`):**
   ```sql
   INSERT INTO buildings (
     tenant_id, name, address, total_apartments
   ) VALUES (
     458923,  -- автоматически из auth()->user()->tenant_id
     'Жилой комплекс "Солнечный"',
     'ул. Гедиминаса, д. 15, Вильнюс',
     45
   )
   ```

3. **Аудит:**
   - Запись в лог: "Building created by user [ID]"

**Интерфейс:**
- Уведомление: ✅ "Building created successfully"
- Перенаправление на `/admin/buildings/[ID]/edit`
- Открывается страница редактирования с вкладками:

```
┌─────────────────────────────────────────────────────┐
│ ← Buildings                                         │
│                                                     │
│ 🏢 ЖИЛОЙ КОМПЛЕКС "СОЛНЕЧНЫЙ"                       │
│                                                     │
│ [Edit] [Delete]                                     │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ [Details] [Properties]                      │   │
│ ├─────────────────────────────────────────────┤   │
│ │                                             │   │
│ │ Name: Жилой комплекс "Солнечный"            │   │
│ │ Address: ул. Гедиминаса, д. 15, Вильнюс    │   │
│ │ Total Apartments: 45                        │   │
│ │ Created: 08.12.2024 14:30                   │   │
│ │                                             │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ 💡 Следующий шаг: Добавьте квартиры в это здание   │
│ [+ Create Property]                                 │
└─────────────────────────────────────────────────────┘
```

---

#### ШАГ 2.2: Создание квартир

**Вариант А: По одной квартире**

**Действие:**
- Админ нажимает **"+ Create Property"**
- ИЛИ переходит в меню: **Operations → Properties → Create**

**Система:**
- Переход на `/admin/properties/create`

**Интерфейс:**
```
┌─────────────────────────────────────────────────────┐
│ ← Properties                                        │
│                                                     │
│ CREATE PROPERTY                                     │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 🏠 PROPERTY DETAILS                         │   │
│ │ Basic information about the property        │   │
│ ├─────────────────────────────────────────────┤   │
│ │                                             │   │
│ │ Address *                                   │   │
│ │ [ул. Гедиминаса, 15, кв. 1                ] │   │
│ │ ℹ️ Full address including apartment number  │   │
│ │                                             │   │
│ │ Type *              Area (m²) *             │   │
│ │ [Residential ▼]     [65.5              ]    │   │
│ │ ℹ️ Property type    ℹ️ Used for calculations│   │
│ │                                             │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 📍 ADDITIONAL INFO                          │   │
│ │ Optional details                            │   │
│ ├─────────────────────────────────────────────┤   │
│ │                                             │   │
│ │ Building                                    │   │
│ │ [🔍 Жилой комплекс "Солнечный"           ▼] │   │
│ │                                             │   │
│ │ Current Tenant                              │   │
│ │ [🔍 Search tenant...                      ▼] │   │
│ │ ℹ️ Leave empty if vacant                    │   │
│ │                                             │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ [Cancel]                                  [Create]  │
└─────────────────────────────────────────────────────┘
```

**Действие:**
- Админ заполняет:
  - Address: `ул. Гедиминаса, 15, кв. 1`
  - Type: выбирает `Residential` из выпадающего списка
  - Area: `65.5`
  - Building: выбирает `Жилой комплекс "Солнечный"` (поиск с автодополнением)
  - Current Tenant: оставляет пустым (пока нет жильцов)
- Нажимает **"Create"**

**Система:**
1. **Валидация:**
   - Address: обязательно
   - Type: обязательно (residential/commercial)
   - Area: обязательно, число > 0
   - Building: опционально, но если указан - проверка принадлежности к tenant_id

2. **Сохранение:**
   ```sql
   INSERT INTO properties (
     tenant_id, building_id, address, type, area_sqm
   ) VALUES (
     458923,
     [ID здания],
     'ул. Гедиминаса, 15, кв. 1',
     'residential',
     65.5
   )
   ```

**Интерфейс:**
- Уведомление: ✅ "Property created successfully"
- Перенаправление на `/admin/properties/[ID]/edit`

**Повторение:**
- Админ повторяет процесс для квартир 2, 3, 4... 45

---

**Вариант Б: Массовое создание (будущая функция)**

```
┌─────────────────────────────────────────────────────┐
│ BULK CREATE PROPERTIES                              │
│                                                     │
│ Building: [Жилой комплекс "Солнечный"            ▼] │
│                                                     │
│ Base Address: [ул. Гедиминаса, 15                 ] │
│                                                     │
│ Apartment Numbers:                                  │
│ From: [1  ] To: [45 ]                              │
│                                                     │
│ Default Type: [Residential ▼]                       │
│ Default Area: [65   ] m²                           │
│                                                     │
│ [Cancel]                      [Create 45 Properties]│
└─────────────────────────────────────────────────────┘
```

---

#### ШАГ 2.3: Установка счетчиков

**Действие:**
- Админ переходит: **Operations → Meters → Create**

**Система:**
- Переход на `/admin/meters/create`

**Интерфейс:**
```
┌─────────────────────────────────────────────────────┐
│ ← Meters                                            │
│                                                     │
│ CREATE METER                                        │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ ⚡ METER DETAILS                            │   │
│ │ Basic meter information                     │   │
│ ├─────────────────────────────────────────────┤   │
│ │                                             │   │
│ │ Property *                                  │   │
│ │ [🔍 ул. Гедиминаса, 15, кв. 1             ▼] │   │
│ │ ℹ️ Select the property for this meter       │   │
│ │                                             │   │
│ │ Type *                                      │   │
│ │ ┌──────────┬──────────┬──────────┬────────┐│   │
│ │ │⚡Electric │💧Cold    │🔥Hot     │🌡️Heat  ││   │
│ │ │  ity     │  Water   │  Water   │  ing   ││   │
│ │ │ [✓]      │ [  ]     │ [  ]     │ [  ]   ││   │
│ │ └──────────┴──────────┴──────────┴────────┘│   │
│ │                                             │   │
│ │ Serial Number *                             │   │
│ │ [EL-2024-001234                           ] │   │
│ │ ℹ️ Unique identifier from the meter         │   │
│ │                                             │   │
│ │ Installation Date *                         │   │
│ │ [📅 08.12.2024                            ] │   │
│ │                                             │   │
│ │ ☑️ Supports Zones (Day/Night)               │   │
│ │ ℹ️ Enable for multi-tariff electricity      │   │
│ │                                             │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ [Cancel]                                  [Create]  │
└─────────────────────────────────────────────────────┘
```

**Действие:**
- Админ заполняет:
  - Property: выбирает `ул. Гедиминаса, 15, кв. 1`
  - Type: выбирает `Electricity` (кликает на карточку)
  - Serial Number: `EL-2024-001234`
  - Installation Date: `08.12.2024`
  - Supports Zones: ставит галочку ✓ (для день/ночь)
- Нажимает **"Create"**

**Система:**
1. **Валидация:**
   - Property: обязательно, должен принадлежать tenant_id
   - Type: обязательно (electricity/water_cold/water_hot/heating)
   - Serial Number: обязательно, уникальный
   - Installation Date: обязательно, не в будущем
   - Supports Zones: boolean

2. **Сохранение:**
   ```sql
   INSERT INTO meters (
     tenant_id, property_id, type, serial_number,
     installation_date, supports_zones
   ) VALUES (
     458923,
     [ID квартиры],
     'electricity',
     'EL-2024-001234',
     '2024-12-08',
     true
   )
   ```

**Интерфейс:**
- Уведомление: ✅ "Meter created successfully"
- Перенаправление на `/admin/meters/[ID]`
- Показывается страница счетчика с вкладкой "Readings" (пока пустая)

**Повторение:**
- Админ создает еще 3 счетчика для этой квартиры:
  - Cold Water: `WC-2024-001234`
  - Hot Water: `WH-2024-001234`
  - Heating: `HT-2024-001234`

---

## СЦЕНАРИЙ 3: ПУТЬ ЖИЛЬЦА (B2C Onboarding)

### 🎬 АКТОРЫ
- **Главный герой:** Жилец (Мария Иванова)
- **Второстепенный герой:** Админ (Иван Петров)

### 📖 СЮЖЕТ

#### ШАГ 3.1: Админ создает учетную запись жильца

**Действие:**
- Админ переходит: **Users → Create**

**Система:**
- Переход на `/admin/users/create`

**Интерфейс:**
```
┌─────────────────────────────────────────────────────┐
│ ← Users                                             │
│                                                     │
│ CREATE USER                                         │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 👤 USER INFORMATION                         │   │
│ ├─────────────────────────────────────────────┤   │
│ │                                             │   │
│ │ Name *                                      │   │
│ │ [Мария Иванова                            ] │   │
│ │                                             │   │
│ │ Email *                                     │   │
│ │ [maria.ivanova@gmail.com                  ] │   │
│ │                                             │   │
│ │ Password *                                  │   │
│ │ [••••••••                                 ] │   │
│ │ [👁️ Show] [🎲 Generate]                     │   │
│ │                                             │   │
│ │ Role *                                      │   │
│ │ ┌─────────┬─────────┬─────────┐            │   │
│ │ │ Admin   │ Manager │ Tenant  │            │   │
│ │ │ [    ]  │ [    ]  │ [✓]     │            │   │
│ │ └─────────┴─────────┴─────────┘            │   │
│ │                                             │   │
│ │ Assigned Property *                         │   │
│ │ [🔍 ул. Гедиминаса, 15, кв. 1             ▼] │   │
│ │ ℹ️ The apartment this tenant will live in   │   │
│ │                                             │   │
│ │ ☑️ Send welcome email with credentials      │   │
│ │                                             │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ [Cancel]                                  [Create]  │
└─────────────────────────────────────────────────────┘
```

**Действие:**
- Админ заполняет:
  - Name: `Мария Иванова`
  - Email: `maria.ivanova@gmail.com`
  - Password: нажимает **"🎲 Generate"** → система генерирует `Temp2024Pass!`
  - Role: выбирает `Tenant`
  - Property: выбирает `ул. Гедиминаса, 15, кв. 1`
  - Send welcome email: ✓ (галочка стоит по умолчанию)
- Нажимает **"Create"**

**Система:**
1. **Валидация:**
   - Email: уникальный
   - Property: должен принадлежать tenant_id админа
   - Property: не должен быть уже занят другим жильцом

2. **Сохранение:**
   ```sql
   INSERT INTO users (
     tenant_id, property_id, parent_user_id,
     name, email, password, role, is_active
   ) VALUES (
     458923,  -- наследуется от админа
     [ID квартиры],
     [ID админа],
     'Мария Иванова',
     'maria.ivanova@gmail.com',
     '$2y$10$...',
     'tenant',
     true
   )
   ```

3. **Отправка email:**
   ```
   Кому: maria.ivanova@gmail.com
   Тема: Добро пожаловать в Rent Counter!
   
   Здравствуйте, Мария Иванова!
   
   Для вас создана учетная запись в системе Rent Counter.
   
   Ваша квартира: ул. Гедиминаса, 15, кв. 1
   
   Данные для входа:
   Email: maria.ivanova@gmail.com
   Пароль: Temp2024Pass!
   
   Войти: https://rent-counter.com/login
   
   В личном кабинете вы можете:
   • Просматривать показания счетчиков
   • Подавать новые показания
   • Просматривать и скачивать счета
   • Отслеживать потребление
   ```

**Интерфейс:**
- Уведомление: ✅ "User created and welcome email sent"

---

#### ШАГ 3.2: Первый вход жильца

**Действие:**
- Мария получает email
- Открывает ссылку
- Вводит email и пароль
- Нажимает "Войти"

**Система:**
- Проверка роли: `tenant`
- Загрузка данных квартиры
- Загрузка счетчиков
- Загрузка последних показаний

**Интерфейс:**
```
┌─────────────────────────────────────────────────────┐
│ 🏠 Rent Counter                                     │
│ 👤 Мария Иванова | 🌐 RU ▼ | 🔔 | 👤 ▼              │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 🏠 МОЯ КВАРТИРА                                     │
│ ул. Гедиминаса, 15, кв. 1                           │
│ 65.5 м² | 3 этаж                                    │
│                                                     │
│ ┌──────────────┬──────────────┬──────────────┐     │
│ │ 💰 Баланс    │ 📊 Счетов    │ ⚡ Счетчиков │     │
│ │ 0.00 €       │ 0            │ 4            │     │
│ └──────────────┴──────────────┴──────────────┘     │
│                                                     │
│ 📊 ПОСЛЕДНИЕ ПОКАЗАНИЯ                              │
│ ┌─────────────────────────────────────────────┐   │
│ │ Счетчик          │ Дата       │ Показание  │   │
│ ├─────────────────────────────────────────────┤   │
│ │ ⚡ Электричество  │ -          │ Нет данных │   │
│ │ 💧 Вода холодная │ -          │ Нет данных │   │
│ │ 🔥 Вода горячая  │ -          │ Нет данных │   │
│ │ 🌡️ Отопление     │ -          │ Нет данных │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ [📝 Подать показания]                              │
│                                                     │
│ 💡 Подайте первые показания счетчиков              │
└─────────────────────────────────────────────────────┘

БОКОВОЕ МЕНЮ:
├─ 🏠 Моя квартира
├─ ⚡ Счетчики
├─ 📊 Показания
├─ 🧾 Счета
└─ ⚙️ Профиль
```

---

## СЦЕНАРИЙ 4: ЕЖЕМЕСЯЧНАЯ РУТИНА (The Loop)

### ШАГ 4.1: Жилец подает показания

**Действие:**
- Мария нажимает **"📝 Подать показания"**
- ИЛИ переходит в меню: **Показания → Создать**

**Интерфейс:**
```
┌─────────────────────────────────────────────────────┐
│ ПОДАТЬ ПОКАЗАНИЯ СЧЕТЧИКОВ                          │
│                                                     │
│ Дата снятия показаний: [📅 08.12.2024            ] │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ ⚡ ЭЛЕКТРИЧЕСТВО (День/Ночь)                │   │
│ │ Серийный номер: EL-2024-001234              │   │
│ ├─────────────────────────────────────────────┤   │
│ │ Предыдущее показание: -                     │   │
│ │                                             │   │
│ │ День:   [1250.5                           ] │   │
│ │ Ночь:   [450.3                            ] │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 💧 ХОЛОДНАЯ ВОДА                            │   │
│ │ Серийный номер: WC-2024-001234              │   │
│ ├─────────────────────────────────────────────┤   │
│ │ Предыдущее: -                               │   │
│ │ Новое:      [150.5                        ] │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 🔥 ГОРЯЧАЯ ВОДА                             │   │
│ │ Серийный номер: WH-2024-001234              │   │
│ ├─────────────────────────────────────────────┤   │
│ │ Предыдущее: -                               │   │
│ │ Новое:      [85.3                         ] │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ ┌─────────────────────────────────────────────┐   │
│ │ 🌡️ ОТОПЛЕНИЕ                                │   │
│ │ Серийный номер: HT-2024-001234              │   │
│ ├─────────────────────────────────────────────┤   │
│ │ Предыдущее: -                               │   │
│ │ Новое:      [420.0                        ] │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ [Отмена]                              [Отправить]  │
└─────────────────────────────────────────────────────┘
```

**Действие:**
- Мария вводит показания
- Нажимает **"Отправить"**

**Система:**
1. **Валидация (в реальном времени):**
   - Показание > предыдущего (если есть)
   - Показание не слишком большое (защита от опечаток)
   - Дата не в будущем

2. **Сохранение (4 записи):**
   ```sql
   INSERT INTO meter_readings (
     meter_id, reading_date, value, zone, entered_by
   ) VALUES
   ([ID счетчика электричество], '2024-12-08', 1250.5, 'day', [ID Марии]),
   ([ID счетчика электричество], '2024-12-08', 450.3, 'night', [ID Марии]),
   ([ID счетчика холодная вода], '2024-12-08', 150.5, null, [ID Марии]),
   ([ID счетчика горячая вода], '2024-12-08', 85.3, null, [ID Марии]),
   ([ID счетчика отопление], '2024-12-08', 420.0, null, [ID Марии])
   ```

**Интерфейс:**
- Анимация: ✅ "Показания успешно отправлены"
- Возврат на дашборд
- Обновленная таблица показаний:

```
📊 ПОСЛЕДНИЕ ПОКАЗАНИЯ
┌─────────────────────────────────────────────┐
│ Счетчик          │ Дата       │ Показание  │
├─────────────────────────────────────────────┤
│ ⚡ Электричество  │ 08.12.2024 │ 1250.5 кВт·ч│
│   (День)         │            │            │
│ ⚡ Электричество  │ 08.12.2024 │ 450.3 кВт·ч│
│   (Ночь)         │            │            │
│ 💧 Вода холодная │ 08.12.2024 │ 150.5 м³   │
│ 🔥 Вода горячая  │ 08.12.2024 │ 85.3 м³    │
│ 🌡️ Отопление     │ 08.12.2024 │ 420.0 кВт·ч│
└─────────────────────────────────────────────┘
```

---

## СЦЕНАРИЙ 5: БИЛЛИНГ И ЗАКРЫТИЕ МЕСЯЦА

### ШАГ 5.1: Наступает 1-е число

**Действие:**
- Админ заходит в систему 1 января 2025
- Переходит: **Dashboard**

**Интерфейс:**
```
┌─────────────────────────────────────────────────────┐
│ 📊 DASHBOARD                                        │
│                                                     │
│ ⚠️ ТРЕБУЮТ ВНИМАНИЯ                                 │
│ ┌─────────────────────────────────────────────┐   │
│ │ 📊 Счетчиков без показаний: 5               │   │
│ │ 📝 Черновиков счетов: 0                     │   │
│ │ ⏰ Просроченных счетов: 0                   │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ 🏠 ОБЪЕКТЫ БЕЗ ПОКАЗАНИЙ ЗА ДЕКАБРЬ                │
│ ┌─────────────────────────────────────────────┐   │
│ │ Адрес                    │ Счетчиков        │   │
│ ├─────────────────────────────────────────────┤   │
│ │ ул. Гедиминаса, 15, кв. 2│ 4 (все)          │   │
│ │ ул. Гедиминаса, 15, кв. 5│ 1 (отопление)    │   │
│ └─────────────────────────────────────────────┘   │
│                                                     │
│ [📞 Напомнить жильцам] [✏️ Ввести вручную]         │
└─────────────────────────────────────────────────────┘
```

---

### ШАГ 5.2: Формирование счетов

**Действие:**
- Админ переходит: **Billing → Invoices → Create**

**Интерфейс:**
```
┌─────────────────────────────────────────────────────┐
│ СОЗДАТЬ СЧЕТ                                        │
│                                                     │
│ Жилец: [🔍 Мария Иванова - кв. 1              ▼]   │
│                                                     │
│ Период:                                             │
│ С: [📅 01.12.2024] По: [📅 31.12.2024]             │
│                                                     │
│ [Отмена]                      [Сформировать счет]  │
└─────────────────────────────────────────────────────┘
```

**Действие:**
- Админ выбирает жильца
- Указывает период
- Нажимает **"Сформировать счет"**

**Система:**
1. Поиск показаний за период
2. Расчет потребления
3. Применение тарифов
4. Расчет hot water circulation
5. Создание черновика счета

**Интерфейс:**
- Перенаправление на страницу черновика счета
- Админ проверяет детали
- Нажимает **"Finalize"** (финализировать)
- Счет становится неизменяемым
- Жилец получает email с уведомлением

---

## 📌 ИТОГОВАЯ СХЕМА ВЗАИМОДЕЙСТВИЯ

```
SUPERADMIN                    ADMIN                      TENANT
    │                           │                          │
    ├─ Создает организацию      │                          │
    │  └─> Email с паролем ──────>                         │
    │                           │                          │
    │                           ├─ Создает здание          │
    │                           ├─ Создает квартиры        │
    │                           ├─ Устанавливает счетчики  │
    │                           │                          │
    │                           ├─ Создает жильца          │
    │                           │  └─> Email с паролем ──────>
    │                           │                          │
    │                           │                          ├─ Подает показания
    │                           │  <── Уведомление ────────┤
    │                           │                          │
    │                           ├─ Формирует счет          │
    │                           │  └─> Email со счетом ──────>
    │                           │                          │
    │                           │                          ├─ Просматривает счет
    │                           │                          ├─ Скачивает PDF
    │                           │                          └─ Оплачивает
```

---

**КОНЕЦ ДОКУМЕНТА**

Этот документ содержит все детали для проектирования интерфейса.
Каждый экран описан с точностью до кнопок и полей ввода.
